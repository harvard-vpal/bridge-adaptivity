# Configuration of additional log streaming to cloudwatch from containers

# 01_delete_old_logs: deletes old container log files

# /etc/awslogs/config/containerlogs.conf: configures awslogs agent to monitor
# container stdout logs

commands:
  01_delete_old_logs:
    command: rm -f /var/log/containers/*-stdouterr.log

files:
  /etc/awslogs/config/containerlogs.conf:
    mode: "000644"
    owner: root
    group: root
    encoding: plain
    content: |
      [bridge.log]
      file = /var/log/containers/bridge-*-stdouterr.log
      log_stream_name = {instance_id}
      log_group_name = /aws/elasticbeanstalk/`{"Ref": "AWSEBEnvironmentName" }`/var/log/containers/bridge

      [nginx.log]
      file = /var/log/containers/nginx-*-stdouterr.log
      log_stream_name = {instance_id}
      log_group_name = /aws/elasticbeanstalk/`{"Ref": "AWSEBEnvironmentName" }`/var/log/containers/nginx

      [worker.log]
      file = /var/log/containers/worker-*-stdouterr.log
      log_stream_name = {instance_id}
      log_group_name = /aws/elasticbeanstalk/`{"Ref": "AWSEBEnvironmentName" }`/var/log/containers/worker


